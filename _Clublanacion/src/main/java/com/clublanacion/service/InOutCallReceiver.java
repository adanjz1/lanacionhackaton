package com.clublanacion.service;import android.content.BroadcastReceiver;import android.content.Context;import android.content.Intent;import android.telephony.TelephonyManager;import com.clublanacion.global.Functions;public class InOutCallReceiver extends BroadcastReceiver {    private static final Object syncObj = new Object();    private static boolean outGoing = false;    private static boolean willLockAgain = false;    public static boolean willLockAgain() {        synchronized (syncObj) {            return willLockAgain;        }    }    private static void setWillLockAgain(boolean state) {        synchronized (syncObj) {            willLockAgain = state;        }    }    public static boolean isOutgoing() {        synchronized (syncObj) {            return outGoing;        }    }    private static void setOutgoing(boolean state) {        synchronized (syncObj) {            outGoing = state;        }    }    public void onReceive(Context context, Intent intent) {        String state = intent.getStringExtra("state");        String number = intent.getStringExtra(Intent.EXTRA_PHONE_NUMBER);        // incoming call or end outgoing call        if (state != null) {            if (state.equals(TelephonyManager.EXTRA_STATE_RINGING)) {                Functions.logV("Phone Ringing");                if (BlockTouchScreenService.isBlockTouch()) {                    setOutgoing(false);                    setWillLockAgain(true);                } else {                    setWillLockAgain(false);                    setOutgoing(true);                }                context.sendBroadcast(new Intent(                        BlockTouchScreenService.RECEIVER_UNLOCK));            } else if (state.equals(TelephonyManager.EXTRA_STATE_IDLE)) {                if (isOutgoing())                    setOutgoing(false);                else {                    Functions.logI("Phone IDLE");                    if (willLockAgain()) {                        setWillLockAgain(false);                        context.sendBroadcast(new Intent(                                BlockTouchScreenService.RECEIVER_LOCK));                    }                }            }        }        // outgoing call start        if (number != null) {            setOutgoing(true);            Functions.logE("Phone Ringing");            context.sendBroadcast(new Intent(                    BlockTouchScreenService.RECEIVER_UNLOCK));        }    }}